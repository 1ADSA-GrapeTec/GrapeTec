<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/estilodash.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>GrapeTec</title>
</head>

<body onload="tipoAdm(), criarSessionStorage()">
    <!-- Menu Lateral -->
    <div class="container">
        <div class="menuLateral">
            <div class="links">
                <ul id="ul_navBar">
                    <li class="itemMenu">
                        <a href="#">
                            <span id="aqui" class="icon"><span class="bi bi-bar-chart-line"></span></span>
                            <span id="aqui" class="link">Visão geral</span>
                        </a>
                    </li>
                    <li class="itemMenu">
                        <a href="meusArmazens.html">
                            <span class="icon"><span class="bi bi-house-door"></span></span>
                            <span class="link">Meus armazéns</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- NAVBAR -->
        <div class="info">
            <div class="navbar">
                <div class="BarraIcon">
                    <img src="assets/images/fav.png" alt="">
                    <h2>GRAPETEC</h2>
                </div>
                <div class="user">
                    <img src="assets/images/IconPessoa.png" alt="">
                    <h3>Olá, <span id="span_nomeUsuario"></span></h3>
                </div>
            </div>
            <!-- HOME -->
            <div class="container02">
                <div class="armazem">
                    <p>Quantidade de<br>
                        armazéns
                    </p>

                    <div class="text">
                        <h1 id="linha">|</h1>
                        <h1>
                            5
                        </h1>
                    </div>
                </div>
                <div id="div_statusArmazem">
                    
                </div>
            </div>

        </div>
    </div>

</body>

</html>

<script>
    var fkEmpresa = sessionStorage.FKEMPRESA_USUARIO;

    function criarSessionStorage() {
        document.getElementById("div_statusArmazem").innerHTML= '';
        fetch("/armazem/visaoGeral", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idEmpresa: fkEmpresa,
                idUsuario: sessionStorage.ID_USUARIO
            })
        }).then(
            function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));
                        sessionStorage.informacoesArmazens = JSON.stringify(json);
                    }).then(
                        JSON.parse(sessionStorage.informacoesArmazens).forEach(item => {
                            document.getElementById("div_statusArmazem").innerHTML += `
                            <div class="dadoArmazem">
                        <div class="temperatura">
                            <h1 class="corVerde">${item.tempMedia}</h1>
                        </div>
                        <div class="endereco">
                            <span><b>Número:</b>${item.numero}</span>
                            <span><b>Rua:</b>${item.rua}</span>
                            <span><b>Bairro:</b>${item.bairro}</span>
                            <span><b>Estado:</b>${item.estado}</span>
                            <span><b>Cidade:</b>${item.cidade}</span>
                            <span><b>Pais:</b>${item.rua}</span>
                        </div>
                    </div>
                    `
                        })
                    ) .then(
                        sessionStorage.informacoesArmazens = {}
                    ) .then(
                        setTimeout(criarSessionStorage,10000)
                        )
                }
            }
        )
    };

    function tipoAdm() {
        var tipoUsuario = sessionStorage.TIPO_USUARIO;
        var nomeUsuario = sessionStorage.NOME_USUARIO;

        span_nomeUsuario.innerHTML = nomeUsuario;

        if (tipoUsuario == 'administrador') {
            ul_navBar.innerHTML += `
        <li class="itemMenu">
            <a href="cadastro.html">
                <span class="icon"><span class="bi bi-plus-circle"></span></span>
                <span class="link">Adicionar novo usuário</span>
            </a>
        </li>
        <li class="itemMenu">
            <a href="#">
                <span class="icon"><span class="bi bi-box-arrow-left"></span></span>
                <span class="link">Sair</span>
            </a>
        </li>
        `
        } else {
            ul_navBar.innerHTML += `
        <li class="itemMenu">
            <a href="#">
                <span class="icon"><span class="bi bi-box-arrow-left"></span></span>
                <span class="link">Sair</span>
            </a>
        </li>
        `
        }
    }
</script>